---
version: "3"

includes:
  ansible: ./tasktest/ansible/Taskfile.yml
  ansible:ansibler: ./tasktest/ansible/Taskfile-ansibler.yml
  ansible:test: ./tasktest/ansible/Taskfile-test.yml
  common: ./tasktest/common/Taskfile.yml
  common:update: ./tasktest/common/Taskfile-update.yml
  fix: ./tasktest/Taskfile-fix.yml
  git: ./tasktest/Taskfile-git.yml
  image: ./tasktest/Taskfile-image.yml
  install: ./tasktest/Taskfile-install.yml
  lint: ./tasktest/Taskfile-lint.yml
  npm: ./tasktest/Taskfile-npm.yml
  packer: ./tasktest/Taskfile-packer.yml
  python: ./tasktest/Taskfile-python.yml
  security: ./tasktest/Taskfile-security.yml
  vscode: ./tasktest/Taskfile-vscode.yml

output: interleaved

vars:
  GALAXY_NAMESPACE:
    sh: if [ -f meta/main.yml ]; then yq e '.galaxy_info.namespace' meta/main.yml; else jq -r '.name' package.json | sed 's/\/.*//' | sed 's/@//'; fi
  GALAXY_ROLE_NAME:
    sh: if [ -f meta/main.yml ]; then yq e '.galaxy_info.role_name' meta/main.yml; else jq -r '.name' package.json | sed 's/.*\///'; fi
  REPOSITORY_SUBTYPE: role
  REPOSITORY_TYPE: ansible

tasks:
  start:
    desc: Set up the project and refresh it with the latest changes
    summary: |
      # Set up the project

      This task will scaffold the project with the latest upstream changes
      and ensure your development environment has all the dependencies installed.

      **Example usage:**
      `task start`
    cmds:
      - task: common:update
