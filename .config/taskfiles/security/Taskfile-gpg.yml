---
version: '3'

tasks:
  conf:
    vars:
      GPG_CONFIG: |
        # Source: https://raw.githubusercontent.com/drduh/config/master/gpg.conf
        personal-cipher-preferences AES256 AES192 AES
        personal-digest-preferences SHA512 SHA384 SHA256
        personal-compress-preferences ZLIB BZIP2 ZIP Uncompressed
        default-preference-list SHA512 SHA384 SHA256 AES256 AES192 AES ZLIB BZIP2 ZIP Uncompressed
        cert-digest-algo SHA512
        s2k-digest-algo SHA512
        s2k-cipher-algo AES256
        charset utf-8
        fixed-list-mode
        no-comments
        no-emit-version
        keyid-format 0xlong
        list-options show-uid-validity
        verify-options show-uid-validity
        with-fingerprint
        require-cross-certification
        no-symkey-cache
        use-agent
        throw-keyids
    cmds:
      - mkdir -p "{{if .CONFIG_DIR_PATH}}{{.CONFIG_DIR_PATH}}{{else}}$HOME/.gnupg{{end}}"
      - echo '{{.GPG_CONFIG}}' > "{{if .CONFIG_DIR_PATH}}{{.CONFIG_DIR_PATH}}{{else}}$HOME/.gnupg{{end}}/gpg.conf"

  donothing: 'true'

  public:import:file:
    todo: Polish
    cmds:
      - gpg --import /mnt/gpg-$KEYID*.asc
      - echo -e "trust\n5\ny" | gpg --command-fd 0 --edit-key "$KEYID"
  public:import:server:
    todo: Add prompt for KEYID
    cmds:
      - gpg --recv $KEYID
      - echo -e "trust\n5\ny" | gpg --command-fd 0 --edit-key "$KEYID"
